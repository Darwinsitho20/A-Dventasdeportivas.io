<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>A&amp;D Deportes UNICEF</title>
<style>
  :root {
    --primary:#005bbb;
    --secondary:#ffd700;
    --bg:#0f111a;
    --card-bg:#1f2335;
    --radius:12px;
    --shadow:0 10px 30px -5px rgba(0,91,187,0.45);
    font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    background:linear-gradient(135deg,#0f111a 0%,#1f2335 70%);
    color:#f0f5ff;
    min-height:100%;
    line-height:1.4;
  }
  header{
    padding:1rem 1.25rem;
    display:flex;
    flex-wrap:wrap;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    position:sticky;
    top:0;
    background:rgba(15,17,26,0.95);
    z-index:10;
    border-bottom:2px solid var(--secondary);
  }
  .logo{
    display:flex;
    align-items:center;
    gap:8px;
    font-weight:700;
    font-size:1.35rem;
    letter-spacing:1px;
  }
  .logo span {color: var(--secondary);}
  nav{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
  }
  nav button{
    background:none;
    border:2px solid var(--secondary);
    padding:8px 14px;
    border-radius:999px;
    cursor:pointer;
    font-weight:600;
    color:#fff;
    position:relative;
    overflow:hidden;
    transition:0.3s;
  }
  nav button:hover{
    background:var(--secondary);
    color:#0f111a;
  }
  .badge{
    background:#ff3b30;
    border-radius:50%;
    padding:4px 9px;
    font-size:0.6rem;
    position:absolute;
    top:-4px;
    right:-4px;
    font-weight:700;
  }
  .hero{
    padding:2rem 1.25rem;
    display:flex;
    flex-wrap:wrap;
    gap:1.5rem;
    align-items:center;
    justify-content:space-between;
    position:relative;
  }
  .hero-text{
    flex:1 1 320px;
    max-width:600px;
  }
  .hero-text h1{
    margin:0;
    font-size:2.5rem;
    line-height:1.1;
  }
  .hero-text p{
    margin:0.75rem 0 1rem;
    font-size:1.05rem;
  }
  .btn-primary{
    background:var(--secondary);
    border:none;
    padding:12px 22px;
    border-radius:999px;
    cursor:pointer;
    font-weight:700;
    letter-spacing:1px;
    display:inline-flex;
    align-items:center;
    gap:6px;
    transition:0.2s;
    text-decoration:none;
    color:#0f111a;
  }
  .btn-primary:hover{
    filter:brightness(1.05);
  }
  .hero-image{
    flex:1 1 300px;
    min-width:240px;
    position:relative;
  }
  .hero-image img{
    width:100%;
    border-radius:16px;
    display:block;
    object-fit:cover;
    box-shadow: var(--shadow);
    border:4px solid var(--secondary);
  }
  .ad-section{
    margin:1rem auto;
    padding:1rem;
    display:flex;
    flex-wrap:wrap;
    gap:1rem;
    justify-content:center;
  }
  .ad-card{
    background:var(--card-bg);
    flex:1 1 280px;
    border-radius:16px;
    padding:1rem;
    position:relative;
    overflow:hidden;
    box-shadow: var(--shadow);
    min-width:250px;
  }
  .ad-card h3{
    margin-top:0;
    font-size:1.3rem;
  }
  .ad-badge{
    position:absolute;
    top:12px;
    right:12px;
    background: var(--secondary);
    padding:6px 12px;
    border-radius:999px;
    font-weight:700;
    font-size:0.75rem;
    color:#0f111a;
  }
  .products{
    padding:1rem 1.25rem 2rem;
    max-width:1200px;
    margin:0 auto;
  }
  .controls{
    display:flex;
    flex-wrap:wrap;
    gap:12px;
    margin-bottom:12px;
    align-items:center;
    justify-content:center;
  }
  .filter-btn{
    background:none;
    border:2px solid #fff;
    padding:6px 16px;
    border-radius:999px;
    cursor:pointer;
    font-weight:600;
    color:#fff;
    transition:0.2s;
  }
  .filter-btn.active, .filter-btn:hover{
    background:var(--secondary);
    color:#0f111a;
    border-color:var(--secondary);
  }
  .search-input{
    padding:10px 16px;
    border-radius:999px;
    border:none;
    outline:none;
    font-size:0.95rem;
    flex:1 1 220px;
    max-width:320px;
  }
  .products-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:1rem;
  }
  .product-card{
    background: var(--card-bg);
    border-radius:16px;
    padding:12px;
    position:relative;
    display:flex;
    flex-direction:column;
    transition:transform .2s;
    box-shadow: var(--shadow);
  }
  .product-card:hover{
    transform:translateY(-4px);
  }
  .product-img{
    width:100%;
    aspect-ratio:1/1;
    overflow:hidden;
    border-radius:12px;
    margin-bottom:8px;
  }
  .product-img img{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
    border-radius:10px;
  }
  .product-info{
    flex:1;
    display:flex;
    flex-direction:column;
    gap:4px;
  }
  .product-info h4{
    margin:4px 0 0;
    font-size:1.1rem;
  }
  .price{
    font-weight:700;
    margin:4px 0;
  }
  .btn-add{
    margin-top:auto;
    background: var(--primary);
    border:none;
    padding:10px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    color:#fff;
    display:flex;
    justify-content:center;
    gap:6px;
    transition:0.2s;
  }
  .btn-add:hover{
    filter:brightness(1.1);
  }
  .cart-modal, .sales-log, .admin-panel, .impact-modal{
    position:fixed;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:rgba(15,17,26,0.95);
    display:none;
    z-index:50;
    padding:1rem;
    overflow:auto;
  }
  .modal-inner{
    max-width:950px;
    margin:0 auto;
    background:#101429;
    border-radius:16px;
    padding:1rem 1.25rem 2rem;
    position:relative;
    box-shadow: var(--shadow);
  }
  .close-btn{
    position:absolute;
    top:10px;
    right:10px;
    background:none;
    border:none;
    font-size:1.3rem;
    cursor:pointer;
    color:#fff;
  }
  table{
    width:100%;
    border-collapse:collapse;
    font-size:0.9rem;
    margin-bottom:1rem;
  }
  th, td{
    padding:10px 8px;
    text-align:left;
    border-bottom:1px solid rgba(255,255,255,0.1);
  }
  th{
    background:rgba(255,255,255,0.04);
    position:sticky;
    top:0;
  }
  .btn-secondary{
    background:none;
    border:2px solid #fff;
    padding:8px 16px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    color:#fff;
    margin-right:6px;
  }
  .sales-footer{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    margin-top:12px;
  }
  .tagline{
    background:rgba(255,255,255,0.05);
    padding:6px 12px;
    border-radius:8px;
    display:inline-block;
    font-size:0.75rem;
    margin-bottom:6px;
  }
  .highlight{
    color: var(--secondary);
  }
  footer{
    padding:1.5rem 1.25rem;
    text-align:center;
    font-size:0.75rem;
    margin-top:40px;
    background:rgba(0,0,0,0.6);
    display:flex;
    flex-wrap:wrap;
    gap:16px;
    justify-content:space-between;
  }
  .socials{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    flex-direction:column;
    align-items:center;
  }
  .pill{
    background:rgba(255,255,255,0.08);
    padding:6px 12px;
    border-radius:999px;
    display:inline-block;
    font-size:0.65rem;
    margin:2px;
  }
  .pill a{text-decoration:none;color:inherit;}
  .social-row {
    display: flex;
    gap: 10px;
    margin-bottom: 6px;
  }
  .social-icon {
    width: 40px;
    height: 40px;
    background: rgba(255,255,255,0.08);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex: 0 0 auto;
    position: relative;
    transition: transform .2s;
  }
  .social-icon:hover {
    transform: scale(1.1);
  }
  .social-icon img {
    width: 70%;
    height: 70%;
    object-fit: contain;
    display: block;
  }
  /* admin styles */
  .admin-header{
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    align-items:center;
    margin-bottom:12px;
  }
  .admin-toggle{
    background:none;
    border:2px solid #fff;
    padding:6px 14px;
    border-radius:999px;
    cursor:pointer;
    font-weight:600;
    color:#fff;
  }
  .payment-box{
    background:rgba(255,255,255,0.05);
    padding:12px;
    border-radius:10px;
    display:flex;
    gap:12px;
    flex-wrap:wrap;
    margin-top:8px;
  }
  .payment-method{
    flex:1;
    min-width:180px;
    background:#0f1a3d;
    padding:12px;
    border-radius:12px;
    position:relative;
  }
  .payment-method h4{
    margin:0 0 6px;
  }
  .badge-new{
    background:#22c1c3;
    padding:4px 8px;
    border-radius:6px;
    font-size:0.55rem;
    position:absolute;
    top:8px;
    right:8px;
  }
  .impact-chart-wrapper{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:14px;
    margin-top:10px;
  }
  .impact-legend{
    display:flex;
    gap:18px;
    flex-wrap:wrap;
    justify-content:center;
    margin-top:4px;
  }
  .impact-box{
    background:rgba(255,255,255,0.05);
    padding:12px;
    border-radius:10px;
    width:100%;
    max-width:600px;
    text-align:center;
  }
  @media (max-width:900px){
    .hero-text h1{
      font-size:2rem;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo">
    <div style="background:var(--secondary);padding:6px 10px;border-radius:8px;">A&amp;D</div>
    <div>Deportes UNICEF</div>
    <span style="font-size:0.8rem; margin-left:4px;">Hombre &amp; Mujer</span>
  </div>
  <nav>
    <button onclick="scrollToSection('products')">Productos</button>
    <button onclick="openCart()">Carrito <span class="badge" id="cart-count">0</span></button>
    <button onclick="openSalesLog()">Ventas</button>
    <button class="admin-toggle" onclick="toggleAdmin()">Admin</button>
    <button onclick="window.scrollTo({top:0, behavior:'smooth'})">Inicio</button>
  </nav>
</header>

<section class="hero" id="inicio">
  <div class="hero-text">
    <div class="tagline">Edición UNICEF | Apoya con cada compra</div>
    <h1><span class="highlight">A&amp;D</span> Ropa y Accesorios Deportivos</h1>
    <p>Diseño deportivo, inclusivo y oficial. Para él, para ella. Vive la pasión de la Liga BetPlay y apoya a la Selección Colombia en todas sus categorías.</p>
    <button class="btn-primary" onclick="scrollToSection('products')">Ver productos</button>
  </div>
  <div class="hero-image">
    <img src="https://images.unsplash.com/photo-1521412644187-c49fa049e84d?auto=format&fit=crop&w=600&q=80" alt="Deportes dinámicos">
  </div>
</section>

<section class="ad-section">
  <div class="ad-card">
    <div class="ad-badge">Patrocinado</div>
    <h3>Liga BetPlay</h3>
    <p>Vive la emoción del fútbol profesional colombiano. Promociones exclusivas con cada compra. Estadísticas en tiempo real próximamente.</p>
    <button class="btn-primary" onclick="window.open('https://www.betplay.com.co/','_blank')">Ver más</button>
  </div>
  <div class="ad-card">
    <div class="ad-badge">Oficial</div>
    <h3>Selección Colombia - Mayores</h3>
    <p>Hombres y mujeres representando al país. Apoya a la tricolor con productos oficiales UNICEF.</p>
    <button class="btn-primary" onclick="window.open('https://fcf.com.co/selecciones/','_blank')">Seguir selección</button>
  </div>
  <div class="ad-card">
    <div class="ad-badge">Únete</div>
    <h3>Edición Solidaria</h3>
    <p>Parte de cada venta se destina a programas deportivos para niños apoyados por UNICEF.</p>
    <button class="btn-primary" onclick="openImpact()">Impacto</button>
  </div>
</section>

<section class="products" id="products">
  <h2 style="text-align:center; margin-bottom:6px;">Catálogo de Productos</h2>
  <p style="text-align:center; margin:0 0 14px;">Ropa y accesorios deportivos para hombre y mujer. Compra fácil, venta registrada automáticamente.</p>
  <div class="controls">
    <div>
      <button class="filter-btn active" data-cat="Todos" onclick="applyFilter(this)">Todos</button>
      <button class="filter-btn" data-cat="Hombre" onclick="applyFilter(this)">Hombre</button>
      <button class="filter-btn" data-cat="Mujer" onclick="applyFilter(this)">Mujer</button>
      <button class="filter-btn" data-cat="Unisex" onclick="applyFilter(this)">Unisex</button>
      <button class="filter-btn" data-cat="Accesorio" onclick="applyFilter(this)">Accesorios</button>
    </div>
    <input class="search-input" placeholder="Buscar producto..." oninput="applySearch(this.value)" />
  </div>
  <div class="products-grid" id="product-grid"></div>
  <div class="payment-box">
    <div class="payment-method">
      <div class="badge-new">Nuevo</div>
      <h4>Pagar con MercadoPago</h4>
      <p>Serás llevado a la pasarela oficial de MercadoPago Colombia.</p>
      <button class="btn-primary" onclick="window.open('https://www.mercadopago.com.co/','_blank')">Ir a MercadoPago</button>
    </div>
    <div class="payment-method">
      <div class="badge-new">Nuevo</div>
      <h4>Pagar con PayU</h4>
      <p>Serás llevado a la plataforma de PayU Colombia.</p>
      <button class="btn-primary" onclick="window.open('https://www.payu.com.co/','_blank')">Ir a PayU</button>
    </div>
  </div>
</section>

<!-- Impacto Modal -->
<div class="impact-modal" id="impact-modal">
  <div class="modal-inner">
    <button class="close-btn" onclick="closeImpact()">✕</button>
    <h2>Impacto Solidario</h2>
    <div class="impact-box">
      <p>Del total de ventas registradas, el <strong>10%</strong> se destina a programas deportivos para niños en Colombia.</p>
      <div class="impact-chart-wrapper">
        <canvas id="impact-chart" width="300" height="300"></canvas>
        <div class="impact-legend">
          <div><span style="display:inline-block;width:12px;height:12px;background:#ffd700;margin-right:6px;border-radius:3px;"></span>Donación (10%)</div>
          <div><span style="display:inline-block;width:12px;height:12px;background:#005bbb;margin-right:6px;border-radius:3px;"></span>Ingreso restante</div>
        </div>
        <div id="impact-values" style="margin-top:8px;font-size:0.9rem;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Carrito Modal -->
<div class="cart-modal" id="cart-modal">
  <div class="modal-inner">
    <button class="close-btn" onclick="closeCart()">✕</button>
    <h2>Carrito de Compras</h2>
    <div id="cart-contents"></div>
    <div class="sales-footer">
      <div><strong>Total:</strong> <span id="cart-total">COP $0</span></div>
      <div style="margin-left:auto;">
        <button class="btn-secondary" onclick="clearCart()">Vaciar carrito</button>
        <button class="btn-primary" onclick="checkout()">Registrar venta</button>
      </div>
    </div>
    <small>Las ventas quedan almacenadas y puedes ver el historial en "Ventas".</small>
  </div>
</div>

<!-- Ventas -->
<div class="sales-log" id="sales-log">
  <div class="modal-inner">
    <button class="close-btn" onclick="closeSalesLog()">✕</button>
    <h2>Historial de Ventas</h2>
    <div id="sales-contents"></div>
    <div style="margin-top:8px;">
      <button class="btn-secondary" onclick="downloadSalesLog()">Exportar (JSON)</button>
      <button class="btn-secondary" onclick="clearSalesLog()">Limpiar historial</button>
    </div>
    <small style="display:block; margin-top:6px;">Cada venta guarda productos, cantidad, total y fecha/hora.</small>
  </div>
</div>

<!-- Panel Admin -->
<div class="admin-panel" id="admin-panel">
  <div class="modal-inner">
    <button class="close-btn" onclick="toggleAdmin()">✕</button>
    <h2>Panel de Administración</h2>
    <div class="admin-header">
      <div class="btn-secondary" onclick="renderAdminProducts()">Gestionar Productos</div>
      <div class="btn-secondary" onclick="renderAdminSales()">Historial de Ventas</div>
    </div>
    <div id="admin-contents">
      <!-- dinámico -->
    </div>
  </div>
</div>

<footer>
  <div>
    <div style="font-weight:700; font-size:1rem;">A&amp;D Deportes UNICEF</div>
    <div>Ropa y accesorios deportivos oficiales para hombres y mujeres. Edición solidaria.</div>
  </div>
  <div class="socials">
    <div class="social-row">
      <a class="social-icon" href="https://www.instagram.com/AdDeportesUNICEF" target="_blank" rel="noopener" aria-label="Instagram">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/instagram.svg" alt="Instagram logo" />
      </a>
      <a class="social-icon" href="https://x.com/AdDeportesUNICEF" target="_blank" rel="noopener" aria-label="X">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg" alt="X logo" />
      </a>
      <a class="social-icon" href="https://www.facebook.com/AdDeportesUNICEF" target="_blank" rel="noopener" aria-label="Facebook">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg" alt="Facebook logo" />
      </a>
      <a class="social-icon" href="https://wa.me/573234202808" target="_blank" rel="noopener" aria-label="WhatsApp">
        <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg" alt="WhatsApp logo" />
      </a>
    </div>
    <div>
      <div class="pill"><a href="https://www.instagram.com/AdDeportesUNICEF" target="_blank" rel="noopener">Instagram</a></div>
      <div class="pill"><a href="https://x.com/AdDeportesUNICEF" target="_blank" rel="noopener">X</a></div>
      <div class="pill"><a href="https://www.facebook.com/AdDeportesUNICEF" target="_blank" rel="noopener">Facebook</a></div>
      <div class="pill"><a href="https://wa.me/573234202808" target="_blank" rel="noopener">WhatsApp</a></div>
    </div>
  </div>
  <div>
    <div>&copy; 2025 A&amp;D. Todos los derechos reservados.</div>
    <div style="margin-top:4px;">Diseñado para ser interactivo, deportivo y solidario.</div>
  </div>
</footer>

<script>
// Datos
const products = [
  {id:1,name:"Camiseta Oficial Hombre",price: Math.round(85 * 4123.4),img:"https://golty.com.co/wp-content/uploads/2024/08/camiseta-deportiva-golty-hombre-latir-naranja-1.webp",category:"Hombre"},
  {id:2,name:"Camiseta Oficial Mujer",price: Math.round(85 * 4123.4),img:"https://aleta.com.co/cdn/shop/files/CAMISETA_DEPORTIVA_CON_DISENO_MANGA_CORTA_AZUL_1203026_1_7809acee-1c8e-4832-8b55-d369fab77b0e.jpg?v=1736532919",category:"Mujer"},
  {id:3,name:"Short Deportivo Hombre",price: Math.round(45.5 * 4123.4),img:"https://i.pinimg.com/736x/0a/04/29/0a0429d01cb7c2a22a02175ebe49c0cf.jpg",category:"Hombre"},
  {id:4,name:"Short Deportivo Mujer",price: Math.round(45.5 * 4123.4),img:"https://www.arequipe.com.co/cdn/shop/files/IMG_8721.jpg?v=1743109197",category:"Mujer"},
  {id:5,name:"Chaqueta Rompevientos",price: Math.round(120 * 4123.4),img:"https://fortalezaceif.com.co/wp-content/uploads/2024/06/Chaqueta-Rompevientos-Blanco-3.jpg",category:"Unisex"},
  {id:6,name:"Mallas Ajustadas Mujer",price: Math.round(60.75 * 4123.4),img:"https://m.media-amazon.com/images/I/51OtgP8+uEL._UY1000_.jpg",category:"Mujer"},
  {id:7,name:"Pantalón de Entrenamiento Hombre",price: Math.round(70 * 4123.4),img:"https://i.pinimg.com/564x/21/ff/27/21ff273f6da439c8a2710fa9454395d7.jpg",category:"Hombre"},
  {id:8,name:"Gorra Deportiva",price: Math.round(22.99 * 4123.4),img:"https://http2.mlstatic.com/D_NQ_NP_2X_759144-CBT78334593827_082024-T.webp",category:"Unisex"},
  {id:9,name:"Calcetas Técnicas",price: Math.round(12.5 * 4123.4),img:"https://http2.mlstatic.com/D_NQ_NP_673628-MLM47606053375_092021-O.webp",category:"Unisex"},
  {id:10,name:"Guantes de Entrenamiento",price: Math.round(34 * 4123.4),img:"https://media.falabella.com/falabellaCO/124892008_01/public",category:"Unisex"},
  {id:11,name:"Balón Oficial",price: Math.round(99.99 * 4123.4),img:"https://assets.adidas.com/images/w_600,f_auto,q_auto/aa6f6d655b3d40a1a71cae680085031a_9366/Balon_Al_Rihla_Pro_Blanco_H57783.jpg",category:"Accesorio"},
  {id:12,name:"Botella Reutilizable",price: Math.round(18 * 4123.4),img:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSM2kYU21slaY0GnQ-9Lp4nlJ4J9QxXs8PKLg&s",category:"Accesorio"},
  {id:13,name:"Audífonos Deportivos",price: Math.round(55.25 * 4123.4),img:"https://panamericana.vtexassets.com/arquivos/ids/456105/audifonos-klip-xtreme-buds-kte-500bk-negro-798302091078.jpg?v=637978302029500000",category:"Accesorio"},
  {id:14,name:"Cinturón de Hidratación",price: Math.round(39.5 * 4123.4),img:"https://static.nike.com/a/images/f_auto/dpr_3.0,cs_srgb/w_403,c_limit/116ff29d-e7a7-4e25-ad18-0e3b6ef164df/mejores-chalecos-y-cinturones-de-hidrataci%C3%B3n-para-running-de-nike.jpg",category:"Accesorio"},
  {id:15,name:"Bolso de Gimnasio",price: Math.round(88 * 4123.4),img:"https://http2.mlstatic.com/D_NQ_NP_776364-MCO52359986262_112022-O.webp",category:"Unisex"},
  {id:16,name:"Camiseta Entrenamiento Mujer",price: Math.round(50 * 4123.4),img:"https://numbisport.com/wp-content/uploads/2022/12/NOLIMITS-MUJER.jpg",category:"Mujer"},
  {id:17,name:"Camiseta Entrenamiento Hombre",price: Math.round(50 * 4123.4),img:"https://prochampions.vtexassets.com/arquivos/ids/419682-800-800?v=637648368328870000&width=800&height=800&aspect=true",category:"Hombre"},
  {id:18,name:"Rodilleras",price: Math.round(29.99 * 4123.4),img:"https://lycanfitness.co/wp-content/uploads/2020/02/principal2.png",category:"Accesorio"},
  {id:19,name:"Sudadera con Capucha",price: Math.round(90 * 4123.4),img:"https://cf.shopee.com.co/file/sg-11134201-7rblk-lmkfureuz3dc47",category:"Unisex"},
  {id:20,name:"Bandas de Resistencia",price: Math.round(25 * 4123.4),img:"https://exitocol.vtexassets.com/arquivos/ids/27191807/bandas-elasticas-ejercicio-resistencia-kit-set-5-niveles.jpg?v=638796412271400000",category:"Accesorio"},
];

// persistencia
function getCart(){ return JSON.parse(localStorage.getItem('ad_cart')||'[]'); }
function saveCart(c){ localStorage.setItem('ad_cart', JSON.stringify(c)); }
function getSales(){ return JSON.parse(localStorage.getItem('ad_sales')||'[]'); }
function saveSales(s){ localStorage.setItem('ad_sales', JSON.stringify(s)); }
function updateCartBadge(){
  const cart = getCart();
  const totalItems = cart.reduce((s,i)=>s+i.qty,0);
  document.getElementById('cart-count').textContent=totalItems;
}

// filtros/búsqueda
let currentCategory = "Todos";
let currentSearch = "";
function applyFilter(btn){
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  currentCategory = btn.dataset.cat;
  renderProducts();
}
function applySearch(term){
  currentSearch = term.trim().toLowerCase();
  renderProducts();
}
function filterAndSearch(p){
  const matchCat = currentCategory === "Todos" || (currentCategory==="Accesorios"? p.category.toLowerCase().includes("accesorio") : p.category === currentCategory);
  const matchSearch = !currentSearch || p.name.toLowerCase().includes(currentSearch);
  return matchCat && matchSearch;
}

// render productos
function renderProducts() {
  const grid = document.getElementById('product-grid');
  grid.innerHTML = '';
  products.filter(filterAndSearch).forEach(p => {
    const card = document.createElement('div');
    card.className='product-card';
    card.innerHTML=`
      <div class="product-img">
        <img src="${p.img}" alt="${p.name}">
      </div>
      <div class="product-info">
        <div class="tagline">${p.category}</div>
        <h4>${p.name}</h4>
        <div class="price">COP $${p.price.toLocaleString()}</div>
        <div style="display:flex; gap:6px; flex-wrap:wrap; margin-top:4px;">
          <button class="btn-add" onclick="addToCart(${p.id})">➕ Agregar</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
}

// carrito
function addToCart(id){
  const cart = getCart();
  const prod = products.find(p=>p.id===id);
  if(!prod) return;
  const existing = cart.find(c=>c.id===id);
  if(existing) existing.qty +=1;
  else cart.push({id:prod.id,name:prod.name,price:prod.price,qty:1});
  saveCart(cart);
  updateCartBadge();
  alert(`${prod.name} agregado al carrito.`);
}
function openCart(){ renderCartContents(); document.getElementById('cart-modal').style.display='block'; }
function closeCart(){ document.getElementById('cart-modal').style.display='none'; }
function renderCartContents(){
  const container = document.getElementById('cart-contents');
  const cart = getCart();
  if(cart.length===0){ container.innerHTML='<p>El carrito está vacío.</p>'; }
  else {
    let html = `<table><thead><tr><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Subtotal</th><th>Acción</th><th>Recibo</th></tr></thead><tbody>`;
    cart.forEach(item=>{
      html+=`<tr>
        <td>${item.name}</td>
        <td>COP $${item.price.toLocaleString()}</td>
        <td>
          <button onclick="changeQty(${item.id}, -1)" style="padding:4px 8px; margin-right:4px;">−</button>
          ${item.qty}
          <button onclick="changeQty(${item.id}, 1)" style="padding:4px 8px; margin-left:4px;">+</button>
        </td>
        <td>COP $${(item.price*item.qty).toLocaleString()}</td>
        <td><button onclick="removeItem(${item.id})" style="background:#ff3b30;border:none;color:#fff;padding:6px 10px;border-radius:6px;cursor:pointer;">Eliminar</button></td>
        <td><button onclick="printItemReceipt(${item.id})" style="background:#00c853;border:none;color:#fff;padding:6px 10px;border-radius:6px;cursor:pointer;">Imprimir</button></td>
      </tr>`;
    });
    html+=`</tbody></table>`;
    container.innerHTML=html;
  }
  const total = getCart().reduce((sum,i)=>sum+i.price*i.qty,0);
  document.getElementById('cart-total').textContent=`COP $${total.toLocaleString()}`;
}
function changeQty(id, delta){
  const cart = getCart();
  const item = cart.find(c=>c.id===id);
  if(!item) return;
  item.qty += delta;
  if(item.qty <1) item.qty=1;
  saveCart(cart);
  renderCartContents();
  updateCartBadge();
}
function removeItem(id){
  let cart = getCart();
  cart = cart.filter(c=>c.id!==id);
  saveCart(cart);
  renderCartContents();
  updateCartBadge();
}
function clearCart(){
  if(!confirm('¿Vaciar todo el carrito?')) return;
  localStorage.removeItem('ad_cart');
  renderCartContents();
  updateCartBadge();
}

// recibos
function generateReceiptHTML(sale){
  let itemsHtml = sale.items.map(i=>`
    <tr>
      <td style="padding:6px;border:1px solid #222;">${i.name}</td>
      <td style="padding:6px;border:1px solid #222;text-align:center;">${i.qty}</td>
      <td style="padding:6px;border:1px solid #222;text-align:right;">COP $${i.price.toLocaleString()}</td>
      <td style="padding:6px;border:1px solid #222;text-align:right;">COP $${(i.price*i.qty).toLocaleString()}</td>
    </tr>`).join('');
  const receipt = `
    <!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"/><title>Recibo ${sale.id}</title>
    <style>body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:#f4f4f7;padding:20px;color:#111;}
    .card{max-width:700px;margin:auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 10px 30px -5px rgba(0,0,0,0.2);}
    h2{margin-top:0;}table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px;}
    th{background:#005bbb;color:#fff;padding:8px;border:1px solid #ccc;}td{padding:6px;border:1px solid #ccc;}
    .total{font-weight:700;font-size:16px;margin-top:10px;text-align:right;}.small{font-size:12px;color:#555;margin-top:8px;}</style>
    </head><body><div class="card">
    <h2>Recibo de venta - A&D Deportes UNICEF</h2>
    <div><strong>ID:</strong> ${sale.id}</div>
    <div><strong>Fecha/Hora:</strong> ${sale.datetime}</div>
    <div style="margin-top:8px;">
      <table><thead><tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th></tr></thead>
      <tbody>${itemsHtml}</tbody></table>
    </div>
    <div class="total">Total: COP $${sale.total.toLocaleString()}</div>
    <div class="small">Gracias por tu compra. Edición UNICEF solidaria.</div>
    </div></body></html>`;
  return receipt;
}
function printReceipt(sale){
  const html = generateReceiptHTML(sale);
  const w = window.open();
  if(!w){ alert('Permite ventanas emergentes para imprimir el recibo.'); return; }
  w.document.write(html);
  w.document.close();
  w.focus();
  w.print();
}
function printItemReceipt(id){
  const cart = getCart();
  const item = cart.find(i=>i.id===id);
  if(!item) return;
  const sale = { id:'R'+Date.now(), datetime:new Date().toLocaleString('es-CO',{timeZone:'America/Bogota'}), items:[{...item}], total:item.price*item.qty };
  printReceipt(sale);
}

// checkout
function checkout(){
  const cart = getCart();
  if(cart.length===0){ alert('Carrito vacío.'); return; }
  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  const sale = { id:'V'+Date.now(), datetime:new Date().toLocaleString('es-CO',{timeZone:'America/Bogota'}), items:cart, total:parseFloat(total.toFixed(2)) };
  const sales = getSales();
  sales.unshift(sale);
  saveSales(sales);
  localStorage.removeItem('ad_cart');
  updateCartBadge();
  renderCartContents();
  alert(`Venta registrada: ${sale.id} - Total: COP $${sale.total.toLocaleString()}`);
  if(confirm('¿Deseas imprimir el recibo ahora?')) printReceipt(sale);
}

// ventas log
function openSalesLog(){ renderSalesLog(); document.getElementById('sales-log').style.display='block'; }
function closeSalesLog(){ document.getElementById('sales-log').style.display='none'; }
function renderSalesLog(){
  const container = document.getElementById('sales-contents');
  const sales = getSales();
  if(sales.length===0){ container.innerHTML='<p>No hay ventas registradas.</p>'; return; }
  let html = '';
  sales.forEach(sale=>{
    const encoded = encodeURIComponent(JSON.stringify(sale));
    html+=`
      <div style="background:rgba(255,255,255,0.03); padding:12px; border-radius:10px; margin-bottom:10px;">
        <div><strong>ID:</strong> ${sale.id} | <strong>Fecha:</strong> ${sale.datetime}</div>
        <div><strong>Total:</strong> COP $${sale.total.toLocaleString()}</div>
        <div style="margin-top:6px;">
          <table>
            <thead><tr>
              <th>Producto</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th>
            </tr></thead>
            <tbody>
              ${sale.items.map(i=>`
                <tr>
                  <td>${i.name}</td>
                  <td>${i.qty}</td>
                  <td>COP $${i.price.toLocaleString()}</td>
                  <td>COP $${(i.price*i.qty).toLocaleString()}</td>
                </tr>`).join('')}
            </tbody>
          </table>
        </div>
        <div style="margin-top:6px; display:flex; gap:8px; flex-wrap:wrap;">
          <button class="btn-primary" onclick="printReceipt(JSON.parse(decodeURIComponent('${encoded}')))">Imprimir recibo</button>
        </div>
      </div>`; 
  });
  container.innerHTML=html;
}
function clearSalesLog(){ if(!confirm('¿Borrar todo el historial de ventas?')) return; localStorage.removeItem('ad_sales'); renderSalesLog(); }
function downloadSalesLog(){ const sales = localStorage.getItem('ad_sales')||'[]'; const blob=new Blob([sales],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ventas_ad.json'; a.click(); URL.revokeObjectURL(url); }

// admin panel
function toggleAdmin(){
  const panel = document.getElementById('admin-panel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
  renderAdminProducts();
}
function renderAdminProducts(){
  const container = document.getElementById('admin-contents');
  let html = `<h3>Productos</h3><table>
    <thead><tr><th>ID</th><th>Nombre</th><th>Precio (COP)</th><th>Categoría</th><th>Acciones</th></tr></thead><tbody>`;
  products.forEach(p=>{
    html+=`<tr>
      <td>${p.id}</td>
      <td contenteditable="true" onblur="editProduct(${p.id}, 'name', this.textContent)">${p.name}</td>
      <td contenteditable="true" onblur="editProduct(${p.id}, 'price', this.textContent.replace(/[^0-9]/g,''))">COP $${p.price.toLocaleString()}</td>
      <td contenteditable="true" onblur="editProduct(${p.id}, 'category', this.textContent)">${p.category}</td>
      <td>
        <button class="btn-secondary" onclick="removeProduct(${p.id})">Eliminar</button>
      </td>
    </tr>`;
  });
  html+=`</tbody></table>`;
  container.innerHTML=html;
}
function editProduct(id, field, value){
  const prod = products.find(p=>p.id===id);
  if(!prod) return;
  if(field==='price'){
    const num = parseInt(value.toString().replace(/\D/g,''),10);
    if(!isNaN(num)) prod.price = num;
  } else if(field==='name'){
    prod.name = value.trim();
  } else if(field==='category'){
    prod.category = value.trim();
  }
  renderProducts();
}
function removeProduct(id){
  const idx = products.findIndex(p=>p.id===id);
  if(idx===-1) return;
  if(!confirm('Eliminar producto?')) return;
  products.splice(idx,1);
  renderAdminProducts();
  renderProducts();
}
function renderAdminSales(){
  const container = document.getElementById('admin-contents');
  const sales = getSales();
  let html = `<h3>Ventas</h3>`;
  if(sales.length===0){
    html += '<p>No hay ventas registradas.</p>';
  } else {
    html += `<div style="margin-bottom:10px;"><button class="btn-secondary" onclick="clearSalesLog()">Limpiar todas las ventas</button></div>`;
    sales.forEach(sale=>{
      html+=`
        <div style="background:rgba(255,255,255,0.03); padding:12px; border-radius:10px; margin-bottom:10px;">
          <div><strong>ID:</strong> ${sale.id} | <strong>Fecha:</strong> ${sale.datetime}</div>
          <div><strong>Total:</strong> COP $${sale.total.toLocaleString()}</div>
          <div style="margin-top:6px;">
            <table>
              <thead><tr><th>Producto</th><th>Cantidad</th><th>Precio</th><th>Subtotal</th></tr></thead>
              <tbody>
                ${sale.items.map(i=>`
                  <tr>
                    <td>${i.name}</td>
                    <td>${i.qty}</td>
                    <td>COP $${i.price.toLocaleString()}</td>
                    <td>COP $${(i.price*i.qty).toLocaleString()}</td>
                  </tr>`).join('')}
              </tbody>
            </table>
          </div>
        </div>`;
    });
  }
  container.innerHTML=html;
}

// impacto modal
function openImpact(){
  document.getElementById('impact-modal').style.display='block';
  renderImpactChart();
}
function closeImpact(){
  document.getElementById('impact-modal').style.display='none';
}
function renderImpactChart(){
  const sales = getSales();
  const totalSales = sales.reduce((s,v)=>s+v.total,0);
  const donation = totalSales * 0.1;
  const income = totalSales - donation;
  const canvas = document.getElementById('impact-chart');
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0,0,canvas.width,canvas.height);
  // Pie chart simple
  const radius = Math.min(canvas.width, canvas.height)/2 - 10;
  const centerX = canvas.width/2;
  const centerY = canvas.height/2;
  const donationAngle = (donation / (totalSales||1)) * Math.PI * 2;
  // Donación (amarillo)
  ctx.beginPath();
  ctx.moveTo(centerX, centerY);
  ctx.fillStyle = '#ffd700';
  ctx.arc(centerX, centerY, radius, 0, donationAngle);
  ctx.closePath();
  ctx.fill();
  // Ingreso restante (azul)
  ctx.beginPath();
  ctx.moveTo(centerX, centerY);
  ctx.fillStyle = '#005bbb';
  ctx.arc(centerX, centerY, radius, donationAngle, Math.PI*2);
  ctx.closePath();
  ctx.fill();
  // Centro blanco circle
  ctx.beginPath();
  ctx.fillStyle = '#0f111a';
  ctx.arc(centerX, centerY, radius * 0.5, 0, Math.PI*2);
  ctx.fill();
  // Texto
  ctx.fillStyle = '#fff';
  ctx.font = '14px system-ui';
  ctx.textAlign='center';
  ctx.fillText('Ventas totales', centerX, centerY - 6);
  ctx.font='bold 16px system-ui';
  ctx.fillText(`COP $${totalSales.toLocaleString()}`, centerX, centerY + 16);
  // leyenda valores
  document.getElementById('impact-values').innerHTML = `
    <div><strong>Donación (10%):</strong> COP $${donation.toLocaleString()}</div>
    <div><strong>Ingreso neto:</strong> COP $${income.toLocaleString()}</div>
  `;
}

// navegación
function scrollToSection(id){
  const el = document.getElementById(id);
  if(el) el.scrollIntoView({behavior:'smooth'});
}

// inicializar
renderProducts();
updateCartBadge();
renderSalesLog(); // mantiene actualizar si abren admin

// helpers repetidos
function getSales(){ return JSON.parse(localStorage.getItem('ad_sales')||'[]'); }
function saveSales(s){ localStorage.setItem('ad_sales', JSON.stringify(s)); }
</script>

</body>
</html>
